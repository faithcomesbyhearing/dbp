option_settings:
  - namespace: aws:elasticbeanstalk:application:environment
    option_name: COMPOSER_HOME
    value: /root

  # Point the app root to the public/ folder.
  - namespace: aws:elasticbeanstalk:container:php:phpini
    option_name: document_root
    value: /public

  # Set here your php.ini `memory_limit` value.
  - namespace: aws:elasticbeanstalk:container:php:phpini
    option_name: memory_limit
    value: 3076M

container_commands:
  00_move_env_file:
    command: "mv /tmp/.env /var/app/staging/.env"

  01_move_pub_key_file:
    command: "mv /tmp/pub.pem /var/app/staging/pub.pem"

  01_move_priv_key_file:
    command: "mv /tmp/priv.pem /var/app/staging/priv.pem"

  10_install_composer_dependencies:
    command: "sudo php -d memory_limit=-1 /usr/bin/composer.phar install --no-dev --no-interaction --prefer-dist --optimize-autoloader"
    cwd: "/var/app/staging"

  20_install_node_dependencies:
    command: "sudo npm install"
    cwd: "/var/app/staging"

  21_build_node_assets:
    command: "sudo npm run prod"
    cwd: "/var/app/staging"
